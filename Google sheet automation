function calculateResults() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet15 = ss.getSheetByName("Sheet15");
  const roleSheet = ss.getSheetByName("Role");

  // Get data from Sheet15
  const sourceSheets = sheet15.getRange("C20:C28").getValues().flat(); // Sheet names
  const lookupValues = sheet15.getRange("D20:D28").getValues().flat(); // Lookup values
  const resultRange = sheet15.getRange("E20:E28");

  // Fetch the Role lookup table
  const roleData = roleSheet.getRange("A:B").getValues();

  // Helper function: Simulate VLOOKUP
  function vlookup(value, lookupTable) {
    for (let i = 0; i < lookupTable.length; i++) {
      if (lookupTable[i][0] === value) {
        return lookupTable[i][1];
      }
    }
    return null;
  }

  const results = [];

  for (let i = 0; i < sourceSheets.length; i++) {
    const sheetName = sourceSheets[i];
    const lookupValue = lookupValues[i];
    if (!sheetName || !lookupValue) {
      results.push(""); // Skip if no sheet name or lookup value
      continue;
    }

    const sheet = ss.getSheetByName(sheetName);
    if (!sheet) {
      results.push("Sheet not found"); // Handle missing sheets
      continue;
    }

    // Get source data
    const dataRange = sheet.getRange("A3:BM367").getValues();
    const columnF = sheet.getRange("F3:F367").getValues();
    const columnC = sheet.getRange("C3:C367").getValues();
    const headers = sheet.getRange("AC2:BM2").getValues()[0];

    let totalSum = 0;

    for (let row = 0; row < dataRange.length; row++) {
      const leftbValue = parseInt(columnF[row][0].toString().substring(0, 2)); // Simulate LEFTB
      if (leftbValue >= 27 && columnC[row][0] === sheet15.getRange("A1").getValue()) {
        for (let col = 28; col < dataRange[row].length; col++) { // AC to BM
          const roleValue = vlookup(headers[col - 28], roleData); // Adjust index for AC:BM
          if (roleValue === lookupValue) {
            totalSum++;
          }
        }
      }
    }
    results.push(totalSum);

  }

  // Write results to Sheet15 column E
  resultRange.setValues(results.map(r => [r]));
}
